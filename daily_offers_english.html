<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ghazi Premium Apartments ‚Äì Daily Offers</title>
    <meta name="description" content="Daily furnished apartment offers in Ajman ‚Äì simple one-link page for clients." />
    <style>
        :root {
            --bg: #0b0f14;
            --card: #131a22;
            --muted: #a7b1bd;
            --text: #eef3f8;
            --brand: #22c55e;
            --accent: #60a5fa;
            --danger: #f97316;
            --list: #dce7f3;
            --badge-bg: #1b2532;
            --badge-text: #cfe3ff;
            --pill-bg: #18212b;
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font: 500 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
                Arial;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Page header layout */
        header {
            display: grid;
            gap: 12px;
            margin-bottom: 24px;
        }

        .title {
            font-weight: 800;
            font-size: clamp(22px, 3vw, 34px);
        }

        .sub {
            color: var(--muted);
        }

        .bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .icon-sprite {
            display: none;
        }

        .pill {
            background: var(--pill-bg);
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid #223140;
            font-size: 13px;
            color: var(--muted);
            transition: all 0.3s ease;
        }

        a {
            color: var(--accent);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Listing grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 18px;
        }

        #offers-container {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 18px;
            width: 100%;
            grid-column: 1 / -1;
        }



        .card {
            grid-column: span 12;
            background: var(--card);
            border-radius: var(--radius);
            border: 1px solid #1e2835;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
            transition: background 0.3s ease, border 0.3s ease;
        }

        .card-inner {
            display: grid;
            grid-template-columns: 1fr;
            width: 100%;
        }

        @media (min-width: 860px) {
            .card-inner {
                grid-template-columns: 50% 50%;
            }
        }

        /* Gallery thumbnails */
        .gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            padding: 12px;
            background: #0e141b;
            transition: background 0.3s ease;
        }

        .gallery img,
        .gallery video {
            width: 100%;
            height: 110px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #223140;
            background: #0b0f14;
            transition: all 0.3s ease;
        }

        .gallery .hero {
            grid-column: span 3;
            height: 220px;
        }

        /* Listing details column */
        .details {
            padding: 14px 16px 18px;
        }

        .code {
            font: 700 12px/1 monospace;
            color: var(--accent);
        }

        .h2 {
            margin: 6px 0 4px;
            font-weight: 750;
            font-size: clamp(18px, 2.2vw, 22px);
        }

        .meta {
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0 14px;
        }

        .badge {
            background: var(--badge-bg);
            border: 1px solid #243244;
            padding: 6px 10px;
            border-radius: 10px;
            font-size: 13px;
            color: var(--badge-text);
            transition: all 0.3s ease;
        }

        .list {
            margin: 10px 0 14px;
            padding-left: 18px;
            color: var(--list);
            transition: color 0.3s ease;
        }

        .price {
            font-weight: 800;
            font-size: 20px;
            color: var(--brand);
        }

        .btns {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn {
            border: 0;
            cursor: pointer;
            color: #07110a;
            background: var(--brand);
            padding: 10px 14px;
            border-radius: 12px;
            font-weight: 750;
            transition: transform 0.06s ease, filter 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn.secondary {
            background: #0f1720;
            border: 1px solid #1f2a37;
            color: #d9e3ef;
        }

        .btn:active {
            transform: translateY(1px);
        }

        footer {
            margin: 34px 0 10px;
            color: var(--muted);
            font-size: 13px;
            text-align: center;
        }

        .divider {
            height: 1px;
            background: #1e2835;
            margin: 22px 0;
            opacity: 0.8;
        }

        /* Theme toggle controls */
        .theme-container {
            position: fixed;
            top: 18px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #334155;
            background: var(--card);
            color: var(--text);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
        }

        .dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 50px;
            background: var(--card);
            border: 1px solid #334155;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .dropdown.active {
            display: flex;
            flex-direction: column;
        }

        .dropdown button {
            background: none;
            border: none;
            color: var(--text);
            padding: 8px 14px;
            text-align: left;
            cursor: pointer;
            font-size: 15px;
            transition: background 0.2s ease;
        }

        .dropdown button:hover {
            background: var(--pill-bg);
        }

        .icon-wa {
            width: 20px;
            height: 20px;
            fill: #fff;
            vertical-align: middle;
            margin-right: 8px;
            transition: transform 0.2s ease;
        }

        .btn:hover .icon-wa {
            transform: scale(1.15);
        }

        /* Custom scrollbars for Chromium/WebKit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #2e343b 0%, #3d434b 100%);
            border-radius: 20px;
            border: 2px solid #0b0f14;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
            border: 2px solid #0b0f14;
        }

        /* Custom scrollbars for Firefox */
        @supports (scrollbar-width: thin) and (scrollbar-color: #3a3f46 #0b0f14) {
            * {
                scrollbar-width: thin;
                scrollbar-color: #3a3f46 #0b0f14;
            }
        }

        /* Lightbox overlay visuals */
        #lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            transition: opacity 0.3s ease;
        }

        #lightbox.hidden {
            display: none;
        }

        #lightbox-media {
            display: flex;
            align-items: center;
            justify-content: center;
            max-height: 90vh;
            max-width: 90vw;
        }

        #lightbox-media img {
            max-width: 90%;
            max-height: 80%;
            border-radius: 12px;
            border: 2px solid #1e2835;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
        }

        #lightbox-media video {
            max-width: 100%;
            max-height: 100%;
            border-radius: 12px;
        }

        #lightbox button,
        #lightbox span {
            position: absolute;
            background: rgba(0, 0, 0, 0.4);
            color: white;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            padding: 8px 14px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        #lightbox button:hover,
        #lightbox span:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        #lightbox-close {
            top: 20px;
            right: 30px;
            font-size: 2.4rem;
        }

        #lightbox-prev {
            left: 50px;
        }

        #lightbox-next {
            right: 50px;
        }
    </style>
</head>

<body>
    <div class="theme-container">
        <button class="theme-toggle" id="themeToggle">‚öôÔ∏è</button>
        <div class="dropdown" id="themeMenu">
            <button data-theme="light">‚òÄÔ∏è Light</button>
            <button data-theme="dark">üåô Dark</button>
            <button data-theme="system">‚öôÔ∏è System</button>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="title">Ghazi Premium Apartments ‚Äî Daily Offers</div>
            <div class="sub">
                Browse today's furnished-apartment listings in Ajman. One link for
                clients; easy to update manually.
            </div>
            <div class="bar">
                <span class="pill" id="today"></span>
                <span class="pill">Updated manually ‚Ä¢ vm1</span>
                <span class="pill">Contact:
                    <a href="https://wa.me/971567242480">+971 56 724 2480</a></span>
            </div>
        </header>

        <main class="grid">
            <!-- Offers populate dynamically via loadOffers() -->
            <svg class="icon-sprite" aria-hidden="true">
                <symbol id="icon-whatsapp" viewBox="0 0 16 16">
                    <path
                        d="M13.601 2.326A7.854 7.854 0 0 0 8.002 0C3.584 0 .003 3.579.003 7.993c0 1.406.366 2.777 1.058 3.99L0 16l4.155-1.092a7.964 7.964 0 0 0 3.847.982h.003c4.416 0 8.002-3.58 8.002-7.993a7.91 7.91 0 0 0-2.406-5.571zM8.002 14.65a6.548 6.548 0 0 1-3.33-.912l-.238-.141-2.468.649.658-2.406-.156-.248a6.493 6.493 0 0 1-.998-3.496c0-3.588 2.93-6.514 6.532-6.514a6.49 6.49 0 0 1 4.64 1.926 6.472 6.472 0 0 1 1.893 4.59c0 3.588-2.93 6.514-6.532 6.514zm3.59-4.903c-.195-.097-1.15-.568-1.329-.633-.179-.065-.31-.097-.44.097s-.504.633-.617.761-.228.145-.423.048c-.195-.097-.825-.304-1.572-.97-.58-.52-.97-1.16-1.085-1.355-.114-.195-.012-.3.085-.397.087-.087.195-.228.292-.342.097-.114.13-.195.195-.325.065-.13.032-.243-.016-.34-.048-.097-.44-1.06-.603-1.45-.159-.382-.322-.33-.44-.335-.114-.006-.244-.007-.374-.007s-.34.048-.52.243c-.179.195-.682.665-.682 1.623s.699 1.885.796 2.014c.097.13 1.377 2.1 3.34 2.942.467.202.831.322 1.114.412.467.149.892.128 1.228.078.374-.056 1.15-.469 1.312-.922.162-.454.162-.845.113-.922-.048-.078-.179-.13-.374-.228z" />
                </symbol>
            </svg>

            <div id="offers-container">
                <p>Loading offers...</p>
            </div>

        </main>

        <div class="divider"></div>

        <footer>
            ¬© <span id="year"></span> Ghazi Premium Apartments ‚Äî Managed by Mohamed
            Ghazi ¬∑ All prices are monthly unless stated.
        </footer>
    </div>

    <script>
        // Step 1: Populate the top pill and footer with today's date
        const today = new Date();
        document.getElementById("today").textContent =
            "Date: " +
            today.toLocaleDateString("en-GB", {
                day: "2-digit",
                month: "short",
                year: "numeric",
            });
        document.getElementById("year").textContent = today.getFullYear();

        // Step 2: Handle theme switching (light, dark, or system preference)
        const root = document.documentElement;
        const themeToggle = document.getElementById("themeToggle");
        const themeMenu = document.getElementById("themeMenu");

        const lightTheme = {
            "--bg": "#e2e8f0",
            "--card": "#ffffff",
            "--muted": "#1e293b",
            "--text": "#0f172a",
            "--brand": "#15803d",
            "--accent": "#047857",
            "--danger": "#b91c1c",
            "--list": "#334155",
            "--badge-bg": "#f1f5f9",
            "--badge-text": "#0f172a",
            "--pill-bg": "#cbd5e1",
        };
        const darkTheme = {
            "--bg": "#0b0f14",
            "--card": "#131a22",
            "--muted": "#a7b1bd",
            "--text": "#eef3f8",
            "--brand": "#22c55e",
            "--accent": "#60a5fa",
            "--danger": "#f97316",
            "--list": "#dce7f3",
            "--badge-bg": "#1b2532",
            "--badge-text": "#cfe3ff",
            "--pill-bg": "#18212b",
        };

        function setTheme(vars) {
            for (const key in vars) root.style.setProperty(key, vars[key]);
        }
        function applyTheme(mode) {
            if (mode === "system") {
                const prefersDark = window.matchMedia(
                    "(prefers-color-scheme: dark)"
                ).matches;
                setTheme(prefersDark ? darkTheme : lightTheme);
                window.matchMedia("(prefers-color-scheme: dark)").onchange = (e) =>
                    setTheme(e.matches ? darkTheme : lightTheme);
            } else {
                setTheme(mode === "dark" ? darkTheme : lightTheme);
            }
        }

        let current = localStorage.getItem("theme") || "system";
        applyTheme(current);

        themeToggle.addEventListener("click", () => {
            themeMenu.classList.toggle("active");
        });

        document.querySelectorAll("#themeMenu button").forEach((btn) => {
            btn.addEventListener("click", () => {
                const selected = btn.getAttribute("data-theme");
                localStorage.setItem("theme", selected);
                applyTheme(selected);
                themeMenu.classList.remove("active");
            });
        });

        // Step 3: Provide a helper to copy the listing code
        function copyCode(btn) {
            const card = btn.closest(".card");
            const code = card.getAttribute("data-code");
            navigator.clipboard.writeText(code).then(() => {
                btn.textContent = "Code Copied ‚úì";
                setTimeout(() => (btn.textContent = "Copy Code"), 1200);
            });
        }

        // Step 4: Fetch the latest offers from the Netlify function
        async function loadOffers() {
            const container = document.getElementById("offers-container");
            try {
                const response = await fetch("https://gpfa.netlify.app/.netlify/functions/getOffers");
                const offers = await response.json();

                container.innerHTML = "";

                offers.forEach((offer, idx) => {
                    const imagesHTML = offer.images
                        .slice(0, 4)
                        .map((img, i) => `<img ${i === 0 ? 'class="hero"' : ''} src="${img}" alt="${offer.title.en} photo" />`)
                        .join("");

                    const badgesHTML = offer.features.en
                        .map(f => `<span class="badge">${f}</span>`)
                        .join("");

                    const allMedia = [
                        ...(offer.images || []),
                        ...(offer.videos || [])
                    ];

                    const cardHTML = `
                    <section class="card" data-code="${offer.code}" data-media='${JSON.stringify([...offer.images, ...(offer.videos || [])])}'>
                        <div class="card-inner">
                            <div class="gallery">${imagesHTML}</div>
                            <div class="details">
                                <div class="code">Code: ${offer.code}</div>
                                <div class="h2">${offer.title.en}</div>
                                <div class="meta">${offer.description.en}</div>
                                <div class="badges">${badgesHTML}</div>
                                <ul class="list">
                                    <li>Monthly: <span class="price">AED ${offer.price}</span></li>
                                    <li>Refundable Deposit: AED ${offer.deposit}</li>
                                    <li>Commission: AED ${offer.commission}</li>
                                </ul>
                                <div class="btns">
                                    <a class="btn" target="_blank" rel="noopener" id="wa-${idx + 1}">
                                        <svg class="icon-wa"><use href="#icon-whatsapp"></use></svg>
                                        <span>WhatsApp</span>
                                    </a>
                                    <button class="btn secondary" onclick="copyCode(this)">
                                        Copy Code
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                `;

                    container.innerHTML += cardHTML;
                });

                // Step 5: Build WhatsApp links after cards render
                const phone = "971567242480";
                [...document.querySelectorAll(".card")].forEach((card, idx) => {
                    const code = card.getAttribute("data-code");
                    const title = card.querySelector(".h2").textContent.trim();
                    const price = card.querySelector(".price").textContent.trim();
                    const msg = encodeURIComponent(
                        `Hello, I'm interested in this listing:\n${title}\nPrice: ${price}\nCode: ${code}\nPlease share availability and location pin.`
                    );
                    const link = `https://wa.me/${phone}?text=${msg}`;
                    const a = card.querySelector(`#wa-${idx + 1}`);
                    if (a) a.setAttribute("href", link);
                });

            } catch (error) {
                console.error("‚ùå Failed to load offers:", error);
                container.innerHTML = "<p style='color:red;'>Failed to load offers. Please try again later.</p>";
            }
            initLightbox();
        }

        // Step 6: Wire up the lightbox overlay for gallery media
        function initLightbox() {
            const lightbox = document.getElementById("lightbox");
            const mediaContainer = document.getElementById("lightbox-media");
            const btnClose = document.getElementById("lightbox-close");
            const btnNext = document.getElementById("lightbox-next");
            const btnPrev = document.getElementById("lightbox-prev");

            let currentMedia = [];
            let currentIndex = 0;

            // Open the lightbox when any gallery image is clicked
            document.querySelectorAll(".gallery img").forEach((img) => {
                img.addEventListener("click", (e) => {
                    const card = e.target.closest(".card");
                    console.log("MEDIA DATA:", card.dataset.media);
                    currentMedia = JSON.parse(card.dataset.media);
                    const clickedSrc = e.target.getAttribute("src");
                    currentIndex = currentMedia.findIndex(src => src === clickedSrc);
                    showMedia();
                    lightbox.classList.remove("hidden");
                });
            });

            function showMedia() {
                const src = currentMedia[currentIndex];
                const isVideo = src.endsWith(".mp4") || src.includes("/video/");
                mediaContainer.innerHTML = isVideo
                    ? `<video controls autoplay src="${src}" style="max-width:90%;max-height:80%;border-radius:12px;border:2px solid #1e2835;"></video>`
                    : `<img src="${src}" style="max-width:90%;max-height:80%;border-radius:12px;border:2px solid #1e2835;" />`;
            }

            btnNext.onclick = () => {
                currentIndex = (currentIndex + 1) % currentMedia.length;
                showMedia();
            };
            btnPrev.onclick = () => {
                currentIndex = (currentIndex - 1 + currentMedia.length) % currentMedia.length;
                showMedia();
            };
            btnClose.onclick = () => {
                lightbox.classList.add("hidden");
                mediaContainer.innerHTML = "";
            };
            lightbox.onclick = (e) => {
                if (e.target === lightbox) {
                    lightbox.classList.add("hidden");
                    mediaContainer.innerHTML = "";
                }
            };
        }

        // Trigger the initial load immediately after parsing
        loadOffers();
    </script>

    <!-- Lightbox overlay markup (hidden until needed) -->
    <div id="lightbox" class="hidden">
        <span id="lightbox-close">&times;</span>
        <button id="lightbox-prev">‚Äπ</button>
        <div id="lightbox-media"></div>
        <button id="lightbox-next">‚Ä∫</button>
    </div>

</body>

</html>
